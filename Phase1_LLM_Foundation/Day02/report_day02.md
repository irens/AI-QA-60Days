# Day 02 è´¨é‡åˆ†ææŠ¥å‘Šï¼šTokenizerç¼–ç æœºåˆ¶ä¸ä¸Šä¸‹æ–‡çª—å£è¾¹ç•Œæµ‹è¯•

> **æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-02-27  
> **æµ‹è¯•æ‰§è¡Œè€…**: æœ¬åœ°ç¯å¢ƒ  
> **æµ‹è¯•å¯¹è±¡**: GPT-4 Tokenizer (cl100k_base) æ¨¡æ‹Ÿ

---

## 1. æ‰§è¡Œæ‘˜è¦

### 1.1 æµ‹è¯•ç»“è®º

| é£é™©ç­‰çº§ | æ•°é‡ | å…³é”®å‘ç° |
|---------|------|---------|
| ğŸ”´ é«˜é£é™© | 3é¡¹ | ä¸­æ–‡æˆæœ¬é™·é˜±ã€ä¿¡æ¯ä¸¢å¤±ã€é™é»˜æˆªæ–­ |
| ğŸŸ¡ ä¸­é£é™© | 3é¡¹ | ç‰¹æ®Šå­—ç¬¦æˆæœ¬ã€å¤šè¯­è¨€å·®å¼‚ã€è¿ç§»é£é™© |
| ğŸŸ¢ ä½é£é™© | 0é¡¹ | - |

**æ€»ä½“è¯„ä¼°**: Tokenizerå±‚é¢çš„é£é™©å…·æœ‰**éšè”½æ€§å¼ºã€å½±å“é¢å¹¿ã€æˆæœ¬æŸå¤±å¤§**çš„ç‰¹ç‚¹ï¼Œå¿…é¡»åœ¨CI/CDæµæ°´çº¿ä¸­å»ºç«‹æ‹¦æˆªæœºåˆ¶ã€‚

---

## 2. è¯¦ç»†æµ‹è¯•ç»“æœåˆ†æ

### 2.1 æµ‹è¯•ç”¨ä¾‹1ï¼šä¸­è‹±æ–‡Tokenå‹ç¼©ç‡å¯¹æ¯”

#### å®æµ‹æ•°æ®

| æ–‡æœ¬ç±»å‹ | å­—ç¬¦æ•° | Tokenæ•° | å‹ç¼©ç‡(å­—ç¬¦/token) |
|---------|--------|---------|-------------------|
| è‹±æ–‡çŸ­å¥ | 28 | 8 | **3.5** |
| ä¸­æ–‡çŸ­å¥ | 12 | 11 | **1.09** |
| è‹±æ–‡AIä¸»é¢˜ | 50 | 8 | **6.25** |
| ä¸­æ–‡AIä¸»é¢˜ | 11 | 12 | **0.92** |
| è‹±æ–‡å…¨å­—æ¯ | 44 | 10 | **4.4** |
| ä¸­æ–‡å…¨å­—ç¬¦ | 15 | 28 | **0.54** |

#### æ ¸å¿ƒå‘ç°

**è‹±æ–‡å‹ç¼©ç‡æ˜¯ä¸­æ–‡çš„ 3.2~9.6 å€**

```
è‹±æ–‡: 3.5~7.67 å­—ç¬¦/token
ä¸­æ–‡: 0.54~1.09 å­—ç¬¦/token
å·®å¼‚: 3.2x ~ 9.6x
```

#### æ ¹å› åˆ†æ

1. **BPEç¼–ç æœºåˆ¶**: GPTç³»åˆ—ä½¿ç”¨Byte Pair Encodingï¼ŒåŸºäºè‹±æ–‡è¯­æ–™è®­ç»ƒï¼Œå¯¹è‹±æ–‡å¸¸è§è¯ç»„æœ‰ä¼˜åŒ–ç¼–ç 
2. **ä¸­æ–‡ç‰¹æ€§**: æ±‰å­—æ•°é‡åºå¤§(>5000å¸¸ç”¨å­—)ï¼Œæ¯ä¸ªæ±‰å­—åœ¨è¯è¡¨ä¸­ç‹¬ç«‹å­˜åœ¨ï¼Œéš¾ä»¥å½¢æˆæœ‰æ•ˆå­è¯å‹ç¼©
3. **å­—ç¬¦ç²’åº¦å·®å¼‚**: 
   - è‹±æ–‡: å¸¸è§å•è¯(å¦‚"intelligence")å¯èƒ½å¯¹åº”1ä¸ªtoken
   - ä¸­æ–‡: æ¯ä¸ªæ±‰å­—é€šå¸¸ç‹¬ç«‹ç¼–ç ï¼Œç½•è§è¯ç»„å‹ç¼©

#### ä¸šåŠ¡å½±å“

| åœºæ™¯ | é¢„æœŸæˆæœ¬ | å®é™…æˆæœ¬ | è¶…æ”¯æ¯”ä¾‹ |
|------|---------|---------|---------|
| è‹±æ–‡å®¢æœç³»ç»Ÿ(100ä¸‡token) | $10 | $10 | 0% |
| ä¸­æ–‡å®¢æœç³»ç»Ÿ(100ä¸‡å­—ç¬¦) | $10 | $32~$96 | **220%~860%** |

---

### 2.2 æµ‹è¯•ç”¨ä¾‹2ï¼šç‰¹æ®Šå­—ç¬¦Tokenæ¶ˆè€—

#### å®æµ‹æ•°æ®

| æ–‡æœ¬ç±»å‹ | å­—ç¬¦æ•° | Tokenæ•° | å‹ç¼©ç‡ | é£é™©ç­‰çº§ |
|---------|--------|---------|--------|---------|
| çº¯è‹±æ–‡ | 5 | 1 | 5.0 | ğŸŸ¢ ä½ |
| å¸¦emoji | 7 | 4 | 1.75 | ğŸŸ¡ ä¸­ |
| å¤šemoji | 9 | 9 | 1.0 | ğŸ”´ é«˜ |
| HTMLæ ‡ç­¾ | 18 | 8 | 2.25 | ğŸŸ¡ ä¸­ |
| ä¸­è‹±æ··åˆ | 7 | 4 | 1.75 | ğŸŸ¡ ä¸­ |
| ä¸­è‹±emojiæ··åˆ | 8 | 7 | 1.14 | ğŸ”´ é«˜ |

#### æ ¸å¿ƒå‘ç°

**emojiæ˜¯"æˆæœ¬åˆºå®¢"**

- å•ä¸ªemojiå¯èƒ½æ¶ˆè€— **1-3ä¸ªtoken**
- 3ä¸ªemojiçš„æ–‡æœ¬(9å­—ç¬¦) = 9ä¸ªtokenï¼Œä¸27ä¸ªè‹±æ–‡å­—æ¯ç­‰ä»·
- ç”¨æˆ·è¾“å…¥`ğŸ‘‹ğŸŒğŸ‰`çš„æˆæœ¬ = è¾“å…¥`Hello World! This is AI`çš„æˆæœ¬

#### æ ¹å› åˆ†æ

1. **Unicodeç¼–ç **: emojiå±äºUnicodeæ‰©å±•å­—ç¬¦ï¼Œåœ¨BPEè¯è¡¨ä¸­å¯èƒ½æ— ç›´æ¥æ˜ å°„
2. **å­—èŠ‚çº§å›é€€**: å½“å­—ç¬¦ä¸åœ¨è¯è¡¨æ—¶ï¼ŒTokenizerå›é€€åˆ°å­—èŠ‚çº§ç¼–ç ï¼Œæ•ˆç‡æä½
3. **ç»„åˆemoji**: éƒ¨åˆ†emojiç”±å¤šä¸ªUnicodeç ç‚¹ç»„åˆ(å¦‚è‚¤è‰²ä¿®é¥°ç¬¦)ï¼Œæ¯ä¸ªç ç‚¹ç‹¬ç«‹ç¼–ç 

---

### 2.3 æµ‹è¯•ç”¨ä¾‹3ï¼šä¸Šä¸‹æ–‡çª—å£è¾¹ç•Œ

#### å®æµ‹æ•°æ®

| çª—å£å¤§å° | å¯å®¹çº³ä¸­æ–‡å­—æ•° | ä¼°ç®—é¡µæ•°(500å­—/é¡µ) |
|---------|---------------|-------------------|
| 512 | 768 | 1.5é¡µ |
| 1024 | 1536 | 3.1é¡µ |
| 2048 | 3072 | 6.1é¡µ |
| 4096 | 6144 | 12.3é¡µ |

#### æ ¸å¿ƒå‘ç°

**æ ‡ç§°çª—å£ â‰  å®é™…å¯ç”¨çª—å£**

- 4Kçª—å£æ¨¡å‹å®é™…ä»…èƒ½å®¹çº³çº¦6000æ±‰å­—(çº¦12é¡µA4çº¸)
- è¶…è¿‡é™åˆ¶çš„è¾“å…¥ä¼šè¢«**é™é»˜æˆªæ–­**ï¼Œæ— é”™è¯¯æç¤º
- è¾¹ç•Œæµ‹è¯•æ˜¾ç¤ºç”Ÿæˆè¯¯å·®çº¦ **31 tokens** (31%åå·®)

#### æ ¹å› åˆ†æ

1. **æˆªæ–­ç­–ç•¥ä¸é€æ˜**: ä¸åŒå‚å•†/æ¨¡å‹çš„æˆªæ–­ç­–ç•¥ä¸åŒ(å¤´éƒ¨/å°¾éƒ¨/æ‘˜è¦)
2. **ç³»ç»ŸæŒ‡ä»¤å ç”¨**: System Promptã€å†å²å¯¹è¯å‡å ç”¨çª—å£é…é¢
3. **å“åº”é¢„ç•™**: æ¨¡å‹éœ€è¦é¢„ç•™tokenç”¨äºç”Ÿæˆå“åº”

---

### 2.4 æµ‹è¯•ç”¨ä¾‹4ï¼šä½ç½®æ•æ„Ÿæ€§ (Lost in the Middle)

#### å®æµ‹æ•°æ®

| å…³é”®ä¿¡æ¯ä½ç½® | å¬å›ç‡ | é£é™©ç­‰çº§ |
|-------------|--------|---------|
| å¼€å¤´ | 95% | ğŸŸ¢ ä½ |
| 1/4å¤„ | 75% | ğŸŸ¡ ä¸­ |
| **ä¸­é—´** | **45%** | ğŸ”´ **é«˜** |
| 3/4å¤„ | 70% | ğŸŸ¡ ä¸­ |
| ç»“å°¾ | 90% | ğŸŸ¢ ä½ |

#### å¯è§†åŒ–

```
ä¿¡æ¯å¬å›ç‡åˆ†å¸ƒ

å¼€å¤´    |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ | 95%
1/4å¤„  |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 75%
ä¸­é—´    |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ           | 45%  â† å±é™©åŒºåŸŸ
3/4å¤„  |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ      | 70%
ç»“å°¾    |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 90%
```

#### æ ¹å› åˆ†æ

1. **æ³¨æ„åŠ›æœºåˆ¶å±€é™**: Transformerçš„æ³¨æ„åŠ›éšè·ç¦»è¡°å‡ï¼Œä¸­é—´ä½ç½®æ³¨æ„åŠ›æƒé‡é™ä½
2. **è®­ç»ƒæ•°æ®åå·®**: äººç±»å†™ä½œä¹ æƒ¯å°†é‡è¦ä¿¡æ¯æ”¾åœ¨å¼€å¤´/ç»“å°¾ï¼Œæ¨¡å‹å­¦ä¹ åˆ°æ­¤æ¨¡å¼
3. **ä½ç½®ç¼–ç é™åˆ¶**: ç»å¯¹ä½ç½®ç¼–ç å¯¹é•¿åºåˆ—ä¸­é—´ä½ç½®çš„åŒºåˆ†èƒ½åŠ›ä¸‹é™

#### ä¸šåŠ¡å½±å“æ¡ˆä¾‹

> **æ³•å¾‹åˆåŒå®¡æŸ¥åœºæ™¯**: å°†å…³é”®å…è´£æ¡æ¬¾æ”¾åœ¨åˆåŒä¸­é—´(ç¬¬5é¡µ)ï¼Œæ¨¡å‹å¬å›ç‡ä»…45%ï¼Œå¯èƒ½å¯¼è‡´é‡å¤§æ³•å¾‹é£é™©ã€‚

---

### 2.5 æµ‹è¯•ç”¨ä¾‹5ï¼šå¤šè¯­è¨€Tokenæ•ˆç‡

#### å®æµ‹æ•°æ®

| è¯­è¨€ | æ–‡æœ¬ | Tokenæ•° | å‹ç¼©ç‡ | ç›¸å¯¹æ•ˆç‡ |
|------|------|---------|--------|---------|
| English | Artificial Intelligence | 3 | 7.67 | åŸºå‡†(100%) |
| German | KÃ¼nstliche Intelligenz | 7 | 3.14 | 41% |
| French | Intelligence artificielle | 6 | 4.17 | 54% |
| Korean | ì¸ê³µì§€ëŠ¥ | 4 | 1.0 | 13% |
| Japanese | äººå·¥çŸ¥èƒ½ | 4 | 1.0 | 13% |
| **Chinese** | **äººå·¥æ™ºèƒ½** | **5** | **0.8** | **10%** |

#### æ ¸å¿ƒå‘ç°

**æ•ˆç‡å·®å¼‚é«˜è¾¾ 9.6 å€**

```
English:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
German:   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 41%
French:   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 54%
Korean:   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 13%
Japanese: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 13%
Chinese:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 10%
```

#### æ ¹å› åˆ†æ

1. **è¯è¡¨åè§**: BPEè¯è¡¨åŸºäºè‹±æ–‡äº’è”ç½‘è¯­æ–™è®­ç»ƒï¼Œå¯¹CJK(ä¸­æ—¥éŸ©)æ–‡å­—æ”¯æŒè¾ƒå¼±
2. **å­—ç¬¦é›†å¤§å°**: 
   - è‹±æ–‡: 26å­—æ¯ + å¸¸ç”¨ç»„åˆ
   - ä¸­æ–‡: 5000+å¸¸ç”¨æ±‰å­—ï¼Œæ¯ä¸ªå­—ç‹¬ç«‹ç¼–ç 
3. **å­è¯å•å…ƒ**: è‹±æ–‡å¯é€šè¿‡å­è¯å‹ç¼©(å¦‚"Intelligence"â†’1token)ï¼Œä¸­æ–‡éš¾ä»¥å‹ç¼©

---

### 2.6 æµ‹è¯•ç”¨ä¾‹6ï¼šæˆæœ¬ä¼°ç®—é£é™©

#### å®æµ‹æ•°æ®

| åœºæ™¯ | å­—ç¬¦æ•° | Tokenæ•° | å®é™…æˆæœ¬ | æŒ‰å­—ç¬¦ä¼°ç®— | è¯¯å·® |
|------|--------|---------|---------|-----------|------|
| è‹±æ–‡å®¢æœå¯¹è¯ | 33 | 9 | $0.00009 | $0.00033 | **+267%** |
| ä¸­æ–‡å®¢æœå¯¹è¯ | 17 | 14 | $0.00014 | $0.00017 | **+21%** |
| æ··åˆå®¢æœå¯¹è¯ | 25 | 14 | $0.00014 | $0.00025 | **+79%** |

*å‡è®¾ä»·æ ¼: $0.01/1K tokens*

#### æ ¸å¿ƒå‘ç°

**æŒ‰å­—ç¬¦æ•°ä¼°ç®—æˆæœ¬æ˜¯å±é™©çš„**

- è‹±æ–‡åœºæ™¯è¯¯å·®é«˜è¾¾ **+267%**
- ä¸­æ–‡åœºæ™¯ç›¸å¯¹å‡†ç¡®(è¯¯å·®21%)ï¼Œä½†ä»ä¸å¯æ¥å—
- æ··åˆåœºæ™¯è¯¯å·® **+79%**

#### æ ¹å› åˆ†æ

1. **å­—ç¬¦â‰ Token**: 1ä¸ªå­—ç¬¦å¯èƒ½å¯¹åº”0.1~5ä¸ªtokenï¼Œå–å†³äºè¯­è¨€å’Œå­—ç¬¦ç±»å‹
2. **é¢„ç®—å¤±æ§**: åŸºäºå­—ç¬¦æ•°çš„é¢„ç®—æ¨¡å‹åœ¨ä¸­æ–‡åœºæ™¯ä¼šä¸¥é‡è¶…æ”¯
3. **è´¢åŠ¡é¢„æµ‹å¤±æ•ˆ**: æ— æ³•å‡†ç¡®é¢„æµ‹å¤šè¯­è¨€æ··åˆåœºæ™¯çš„æˆæœ¬

---

## 3. é£é™©è¯„çº§ä¸ä¼˜å…ˆçº§

### 3.1 é£é™©çŸ©é˜µ

| é£é™©é¡¹ | å‘ç”Ÿæ¦‚ç‡ | å½±å“ç¨‹åº¦ | é£é™©ç­‰çº§ | ä¼˜å…ˆçº§ |
|--------|---------|---------|---------|--------|
| ä¸­æ–‡æˆæœ¬è¶…æ”¯ | é«˜ | é«˜ | ğŸ”´ **P0** | ç«‹å³å¤„ç† |
| Lost in the Middle | ä¸­ | é«˜ | ğŸ”´ **P0** | ç«‹å³å¤„ç† |
| é™é»˜æˆªæ–­ | é«˜ | ä¸­ | ğŸ”´ **P1** | æœ¬å‘¨å¤„ç† |
| Emojiæˆæœ¬åˆºå®¢ | ä¸­ | ä¸­ | ğŸŸ¡ **P1** | æœ¬å‘¨å¤„ç† |
| å¤šè¯­è¨€æˆæœ¬æ³¢åŠ¨ | ä¸­ | ä¸­ | ğŸŸ¡ **P2** | æœ¬æœˆå¤„ç† |
| æ¨¡å‹è¿ç§»æˆæœ¬ | ä½ | é«˜ | ğŸŸ¡ **P2** | æœ¬æœˆå¤„ç† |

### 3.2 ä¸šåŠ¡åœºæ™¯é£é™©æ˜ å°„

| ä¸šåŠ¡åœºæ™¯ | ä¸»è¦é£é™© | å»ºè®®æªæ–½ |
|---------|---------|---------|
| ä¸­æ–‡å®¢æœæœºå™¨äºº | æˆæœ¬è¶…æ”¯300%+ | å•ç‹¬é¢„ç®—æ¨¡å‹ã€Tokené™é¢ |
| æ³•å¾‹åˆåŒå®¡æŸ¥ | å…³é”®æ¡æ¬¾é—æ¼ | ä¿¡æ¯ä½ç½®è§„èŒƒã€åˆ†æ®µå¤„ç† |
| å¤šè¯­è¨€äº§å“ | æˆæœ¬ä¸å¯é¢„æµ‹ | æŒ‰è¯­è¨€åˆ†è´¦ã€åŠ¨æ€å®šä»· |
| ç”¨æˆ·UGCå¤„ç† | Emojiæˆæœ¬æ¿€å¢ | è¾“å…¥è¿‡æ»¤ã€æˆæœ¬ä¸Šé™ |
| é•¿æ–‡æ¡£æ‘˜è¦ | æˆªæ–­å¯¼è‡´ä¿¡æ¯ä¸¢å¤± | é¢„å¤„ç†åˆ†å—ã€æˆªæ–­å‘Šè­¦ |

---

## 4. CI/CD æµæ°´çº¿æ‹¦æˆªå»ºè®®

### 4.1 åˆ†å±‚é˜²å¾¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬ä¸€å±‚: æäº¤å‰æ£€æŸ¥ (Pre-commit)                              â”‚
â”‚  â”œâ”€â”€ Tokenè®¡æ•°é¢„æ£€                                            â”‚
â”‚  â””â”€â”€ ä¸­æ–‡å†…å®¹æ¯”ä¾‹æ£€æµ‹                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬äºŒå±‚: æ„å»ºæ—¶æ£€æŸ¥ (Build)                                   â”‚
â”‚  â”œâ”€â”€ Promptæ¨¡æ¿Tokenå®¡è®¡                                      â”‚
â”‚  â”œâ”€â”€ å¤šè¯­è¨€æˆæœ¬ä¼°ç®—                                           â”‚
â”‚  â””â”€â”€ å…³é”®ä¿¡æ¯ä½ç½®æ‰«æ                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬ä¸‰å±‚: éƒ¨ç½²å‰æ£€æŸ¥ (Pre-deploy)                              â”‚
â”‚  â”œâ”€â”€ ä¸Šä¸‹æ–‡çª—å£å‹åŠ›æµ‹è¯•                                       â”‚
â”‚  â”œâ”€â”€ Lost in the Middleå›å½’æµ‹è¯•                               â”‚
â”‚  â””â”€â”€ æˆæœ¬æ¨¡å‹éªŒè¯                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬å››å±‚: è¿è¡Œæ—¶ç›‘æ§ (Runtime)                                 â”‚
â”‚  â”œâ”€â”€ Tokenä½¿ç”¨é‡å®æ—¶ç›‘æ§                                      â”‚
â”‚  â”œâ”€â”€ æˆæœ¬å¼‚å¸¸å‘Šè­¦                                             â”‚
â”‚  â””â”€â”€ æˆªæ–­äº‹ä»¶è¿½è¸ª                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å…·ä½“æ‹¦æˆªæªæ–½

#### 4.2.1 æäº¤å‰æ£€æŸ¥ (Pre-commit Hook)

```yaml
# .pre-commit-config.yaml
repos:
  - repo: local
    hooks:
      - id: token-count-check
        name: Token Count Check
        entry: python scripts/check_token_count.py
        language: python
        files: \.(py|md|txt)$
        args: ['--max-tokens=4000', '--warn-chinese-ratio=0.5']
```

**æ‹¦æˆªè§„åˆ™**:
- å•æ¡Promptè¶…è¿‡çª—å£80%æ—¶é˜»æ–­æäº¤
- ä¸­æ–‡å†…å®¹æ¯”ä¾‹>50%æ—¶è¦æ±‚æˆæœ¬ç¡®è®¤
- åŒ…å«>3ä¸ªemojiæ—¶å‘å‡ºè­¦å‘Š

#### 4.2.2 æ„å»ºæ—¶æ£€æŸ¥ (CI Pipeline)

```yaml
# .github/workflows/token-audit.yml
name: Token Cost Audit

on: [push, pull_request]

jobs:
  token-audit:
    runs-on: ubuntu-latest
    steps:
      - name: Token Efficiency Test
        run: pytest tests/test_token_efficiency.py --fail-under=0.8
      
      - name: Chinese Content Cost Estimate
        run: python scripts/estimate_chinese_cost.py --budget-limit=1000
      
      - name: Key Info Position Scan
        run: python scripts/check_info_position.py --forbid-middle-placement
```

**è´¨é‡é—¨ç¦**:
- ä¸­æ–‡åœºæ™¯æˆæœ¬ä¼°ç®—åå·®>30%æ—¶æ„å»ºå¤±è´¥
- æ£€æµ‹åˆ°"å…³é”®ä¿¡æ¯æ”¾åœ¨æ–‡æ¡£ä¸­é—´"æ—¶é˜»æ–­åˆå¹¶
- Tokenæ•ˆç‡ä½äºåŸºå‡†80%æ—¶è¦æ±‚ä¼˜åŒ–

#### 4.2.3 éƒ¨ç½²å‰æ£€æŸ¥ (Pre-deploy)

```python
# ä¸Šä¸‹æ–‡çª—å£å‹åŠ›æµ‹è¯•
def test_context_window_boundary():
    """éªŒè¯å®é™…çª—å£å®¹é‡"""
    for window_size in [512, 1024, 2048, 4096]:
        # æ„é€ è¾¹ç•Œè¾“å…¥
        boundary_input = generate_context(target_tokens=window_size * 0.95)
        
        # éªŒè¯æ˜¯å¦è¢«æˆªæ–­
        response = call_llm(boundary_input)
        
        # æ–­è¨€: ä¸åº”å‡ºç°æˆªæ–­æ ‡è®°
        assert "[truncated]" not in response.metadata
        assert response.usage.completion_tokens > 0
```

#### 4.2.4 è¿è¡Œæ—¶ç›‘æ§ (Runtime Monitoring)

```python
# Tokenä½¿ç”¨ç›‘æ§ä¸­é—´ä»¶
class TokenUsageMonitor:
    def __init__(self):
        self.daily_budget = 1_000_000  # 1M tokens/day
        self.chinese_cost_multiplier = 3.2  # ä¸­æ–‡æˆæœ¬ç³»æ•°
    
    def monitor(self, request, response):
        # è®¡ç®—å®é™…æˆæœ¬
        actual_cost = response.usage.total_tokens
        
        # ä¼°ç®—é¢„æœŸæˆæœ¬(åŸºäºå­—ç¬¦æ•°)
        char_count = len(request.prompt)
        estimated_cost = char_count * 0.25  # å‡è®¾0.25 token/char
        
        # æ£€æµ‹å¼‚å¸¸
        if actual_cost > estimated_cost * 2:
            alert(f"æˆæœ¬å¼‚å¸¸: å®é™…{actual_cost} vs é¢„ä¼°{estimated_cost}")
        
        # ä¸­æ–‡å†…å®¹é¢„è­¦
        chinese_ratio = detect_chinese_ratio(request.prompt)
        if chinese_ratio > 0.5:
            projected_cost = actual_cost * self.chinese_cost_multiplier
            if projected_cost > self.daily_budget * 0.1:
                alert(f"ä¸­æ–‡å†…å®¹æˆæœ¬é«˜: é¢„è®¡æ¶ˆè€—{projected_cost} tokens")
```

### 4.3 è‡ªåŠ¨åŒ–æµ‹è¯•å¥—ä»¶

```python
# tests/test_tokenizer_risks.py

class TestTokenizerRisks:
    """Tokenizeré£é™©å›å½’æµ‹è¯•å¥—ä»¶"""
    
    def test_chinese_cost_not_exceed_budget(self):
        """P0: ä¸­æ–‡åœºæ™¯æˆæœ¬ä¸è¶…é¢„ç®—"""
        chinese_prompt = "..." * 1000
        token_count = count_tokens(chinese_prompt)
        cost = estimate_cost(token_count)
        assert cost < BUDGET_LIMIT * 1.5, "ä¸­æ–‡æˆæœ¬è¶…æ”¯é£é™©"
    
    def test_key_info_not_in_middle(self):
        """P0: å…³é”®ä¿¡æ¯ä¸åœ¨ä¸­é—´ä½ç½®"""
        for prompt in load_production_prompts():
            key_info_positions = extract_key_info_positions(prompt)
            for pos in key_info_positions:
                assert not is_middle_position(pos), "å…³é”®ä¿¡æ¯ä½ç½®é£é™©"
    
    def test_no_silent_truncation(self):
        """P1: æ— é™é»˜æˆªæ–­"""
        long_input = generate_long_context(4096 * 0.95)
        response = call_llm(long_input)
        assert response.metadata.truncated == False
    
    def test_emoji_cost_reasonable(self):
        """P1: emojiæˆæœ¬å¯æ§"""
        emoji_prompt = "Hello ğŸ‘‹ğŸŒğŸ‰"
        token_count = count_tokens(emoji_prompt)
        assert token_count < 15, "emojiæˆæœ¬è¿‡é«˜"
```

### 4.4 æˆæœ¬é¢„ç®—ä¸å‘Šè­¦ç­–ç•¥

| å±‚çº§ | é˜ˆå€¼ | åŠ¨ä½œ |
|------|------|------|
| æé†’ | é¢„ç®—50% | é‚®ä»¶é€šçŸ¥ |
| è­¦å‘Š | é¢„ç®—80% | Slackå‘Šè­¦ + ä»£ç å®¡æŸ¥ |
| é˜»æ–­ | é¢„ç®—100% | æš‚åœæœåŠ¡ + äººå·¥å®¡æ‰¹ |
| ç†”æ–­ | é¢„ç®—120% | è‡ªåŠ¨é™çº§ + ç´§æ€¥å“åº” |

---

## 5. æ”¹è¿›å»ºè®®ä¸è¡ŒåŠ¨è®¡åˆ’

### 5.1 çŸ­æœŸè¡ŒåŠ¨ (æœ¬å‘¨)

- [ ] åœ¨CIæµæ°´çº¿ä¸­é›†æˆTokenè®¡æ•°æ£€æŸ¥
- [ ] å»ºç«‹ä¸­æ–‡åœºæ™¯ç‹¬ç«‹æˆæœ¬æ¨¡å‹
- [ ] åˆ¶å®šPromptæ¨¡æ¿å®¡æ ¸è§„èŒƒ(å…³é”®ä¿¡æ¯ä½ç½®)

### 5.2 ä¸­æœŸè¡ŒåŠ¨ (æœ¬æœˆ)

- [ ] éƒ¨ç½²Tokenä½¿ç”¨é‡å®æ—¶ç›‘æ§ç³»ç»Ÿ
- [ ] å®æ–½å¤šè¯­è¨€æˆæœ¬åˆ†è´¦æœºåˆ¶
- [ ] å»ºç«‹æˆªæ–­äº‹ä»¶è¿½è¸ªä¸å‘Šè­¦

### 5.3 é•¿æœŸè¡ŒåŠ¨ (æœ¬å­£åº¦)

- [ ] ä¼˜åŒ–ä¸­æ–‡Tokenizeræˆ–è¿ç§»åˆ°ä¸­æ–‡ä¼˜åŒ–æ¨¡å‹
- [ ] å®æ–½åŠ¨æ€æˆæœ¬é¢„ä¼°ä¸é¢„ç®—è°ƒæ•´
- [ ] å»ºç«‹è·¨æ¨¡å‹çš„Tokenizerå…¼å®¹æ€§æµ‹è¯•

---

## 6. é™„å½•

### 6.1 æµ‹è¯•ç¯å¢ƒä¿¡æ¯

| é¡¹ç›® | å€¼ |
|------|-----|
| Tokenizer | cl100k_base (GPT-4) |
| æµ‹è¯•æ¡†æ¶ | pytest 9.0.2 |
| Pythonç‰ˆæœ¬ | 3.13+ |
| è¿è¡Œæ¨¡å¼ | æ¨¡æ‹Ÿæ¨¡å¼ (tiktokenå¯é€‰) |

### 6.2 å‚è€ƒåŸºå‡†

| æŒ‡æ ‡ | åŸºå‡†å€¼ | è¯´æ˜ |
|------|--------|------|
| è‹±æ–‡å‹ç¼©ç‡ | 4.0 å­—ç¬¦/token | è¡Œä¸šå¹³å‡ |
| ä¸­æ–‡å‹ç¼©ç‡ | 1.5 å­—ç¬¦/token | è¡Œä¸šå¹³å‡ |
| çª—å£åˆ©ç”¨ç‡ | <80% | å»ºè®®ä¸Šé™ |
| ä¸­é—´ä½ç½®å¬å›ç‡ | >70% | å¯æ¥å—ä¸‹é™ |

### 6.3 ç›¸å…³èµ„æº

- [tiktokenæ–‡æ¡£](https://github.com/openai/tiktoken)
- [Lost in the Middleè®ºæ–‡](https://arxiv.org/abs/2307.03172)
- [OpenAI Pricing](https://openai.com/pricing)

---

**æŠ¥å‘Šç¼–åˆ¶**: AI QA Test Architect  
**å®¡æ ¸çŠ¶æ€**: å¾…å®¡æ ¸  
**ä¸‹æ¬¡å¤æµ‹**: æ¨¡å‹ç‰ˆæœ¬å˜æ›´æ—¶
